<script>
  // window.onerror 會快於 window.addEventListener('error')
  // window.onerror = onerrorHandle;

  //   處理外部資源讀取失敗
  window.addEventListener("error", mark_src, true);

  function mark_src(event) {
    event.preventDefault()
    let target = event.target ? event.target : undefined;
    if (!target) {
      return;
    }
    let url = target.src || target.href
    if (!url) {
      return
    }
    const payload = JSON.stringify({
      pathname: location.pathname,
      tagName: target.tagName,
      href: target.href,
      src: target.src
    })
    fetch('/api/report/srcErr', {
      method: 'POST',
      body: payload
    }).then(response => console.log(response.json()))
    return
  }
</script>